<app-header></app-header>
<app-sidebar></app-sidebar>
<div class="main-content">
  <div class="container-fluid">
    <div class="row">
      <div class="col-lg-12">
        <div class="settings-tab">

          <!-- Settings Tabs -->
          <ul class="nav nav-tabs" role="tablist">
            <li class="nav-item nav-item-cus"> <a class="nav-link nav-link-cus pl-0 active" data-toggle="tab"
                href="#tabs-1" role="tab">Settings</a> </li>
            <li class="nav-item nav-item-cus"> <a class="nav-link nav-link-cus pl-0" data-toggle="tab" href="#tabs-2"
                role="tab" (click)="checkMFAConfig()">Multi Factor Authentication</a> </li>
            <li class="nav-item nav-item-cus"> <a class="nav-link nav-link-cus pl-0" data-toggle="tab" href="#tabs-3"
                role="tab">Change Password</a> </li>
          </ul>
          <!-- Tab panes -->
          <div class="tab-content tab-content-cus">

            <!-- Color settings -->
            <div class="tab-pane active" id="tabs-1" role="tabpanel">
              <div class="settings-gray-section">
                <div class="row">
                  <div class="col-lg-6">
                    <div class="color-settings">
                      <h5>Color Settings</h5>
                      <form [formGroup]="colorForm" (ngSubmit)="onColorSubmit()">
                        <div class="color-box">
                          <div class="row">
                            <div class="col-lg-6">
                              <div class="color-range">
                                <p class="d-flex justify-content-between">
                                  <span class="align-self-center">Color Range</span>
                                  <input type="color" id="colorPicker" formControlName="color" style="cursor: pointer;">
                                </p>
                              </div>
                            </div>
                          </div>
                          <div class="container">
                            <div class="row mt-4">
                              <div class="col-sm-12">
                                <ngx-slider
                                  [options]="options"
                                  [value]="minValue"
                                  [highValue]="maxValue"
                                  (valueChange)="onMinValueChange($event)"
                                  (highValueChange)="onMaxValueChange($event)">
                                </ngx-slider>
                              </div>
                            </div>
                          </div>
                          <div class="row mt-4">
                            <div class="col-lg-12 text-right">
                              <div class="add-btn">
                                <button class="add-button">Add</button>
                              </div>
                            </div>
                          </div>
                        </div>
                      </form>
                    </div>
                  </div>
                  <div class="col-lg-6">
                    <div class="color-box-plus-min">
                      <ng-container *ngFor="let setting of colorSettings?.settings; let i = index">
                        <div class="row" [ngClass]="{'mt-2' : i > 0}">
                          <div class="col-lg-6">
                            <ng-container *ngIf="setting.min == 101 && setting.max == 101; else not100">
                              <h6>100%+</h6>
                            </ng-container>
                            <ng-template #not100>
                              <h6>{{setting.min}}-{{setting.max}}%</h6>
                            </ng-template>
                          </div>
                          <div class="col-lg-6 text-right">
                            <div class="float-right d-flex">
                              <ng-container *ngIf="setting.min == 101 && setting.max == 101; else not100Color">
                                <div class="color-box-two" [ngStyle]="{'background-color': setting.color}" [style.background]="selectedColor2"></div>
                                <div class="plus-minus above100">
                                  <label for="colorPicker2"><img src="assets/img/edit.png"></label>
                                  <input type="color" id="colorPicker2" value="#000000" [(ngModel)]="selectedColor2" (change)="onColorChange2(selectedColor2, i)">
                                </div>
                              </ng-container>
                              <ng-template #not100Color>
                                <div class="color-box-two" [ngStyle]="{'background-color': setting.color}"></div>
                                <div class="plus-minus" (click)="removeColor(i)" style="cursor: pointer;">
                                  <img src="assets/img/minus.png">
                                </div>
                              </ng-template>
                            </div>
                          </div>
                        </div>
                      </ng-container>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-lg-12 text-center">
                    <button class="btn btn-light btn_default max-270" (click)="saveColorSetting()" [disabled]="colorSubmitFlag">Save</button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Multi factor authentication -->
            <div class="tab-pane" id="tabs-2" role="tabpanel">
              <ng-container *ngIf="!qr.isChecking; else loading">
                <div class="factor-cl" *ngIf="!qr.isAvailable">
                  <div class="row">
                    <div class="col-8 align-self-center pt-1">
                      <h5>{{qr.isMFASetup ? 'Reset Authentication' : 'Setup Authenticator App'}}</h5>
                    </div>
                    <div class="col-4 text-right">
                      <div class="">
                        <div class="form-check custom-box">
                          <!-- <input type="checkbox" class="form-check-input" id="generateCheck" [checked]="qr.isMFASetup"
                            [disabled]="qr.isGenerating || qr.isResetting" (change)="generateQRCode($event)"> -->
                          <button class="btn btn-outline-dark my-0" *ngIf="!qr.isMFASetup" (click)="generateQRCode()" [disabled]="qr.isGenerating">Set Up</button>
                          <button class="btn btn-danger my-0"*ngIf="qr.isMFASetup" (click)="resetMFA()" [disabled]="qr.isResetting">Reset</button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="factor-cl" *ngIf="qr.isAvailable">
                  <h1 class="font-weight-normal mb-4">Scan the QR code</h1>
                  <p>
                    Use the authenticator app to scan the QR code. This will connect the Authenticator app with you
                    account.
                    <br>
                    After you scan the QR code, Enter the code below:
                  </p>
                  <img [src]="qr.code" alt="">
                  <div>
                    <form [formGroup]="authenticatorForm" (ngSubmit)="onAuthenticationSubmit()">
                      <div class="form-group">
                        <label class="font-weight-bold mb-0" for="code">Enter the 6-digit code you see in your
                          authenticator app</label>
                        <input type="text" class="form-control font-weight-normal" id="code"
                          placeholder="Authentication code" formControlName="code" [maxlength]="6"
                          [ngClass]="{ 'is-invalid': (qr.submitted || authenticatorControls.code.touched) && authenticatorControls.code.errors }">
                        <div
                          *ngIf="(qr.submitted || authenticatorControls.code.touched) && authenticatorControls.code.errors"
                          class="invalid-feedback">
                          <div *ngIf="authenticatorControls.code.errors.required">Code is required!</div>
                        </div>
                      </div>
                      <button class="btn btn-light btn_default max-270 mt-5" [disabled]="qr.submitFlag">
                        <div class="spinner-border text-light align-top" role="status" *ngIf="qr.submitFlag">
                          <span class="sr-only">Loading...</span>
                        </div>
                        <ng-container *ngIf="!qr.submitFlag">Confirm</ng-container>
                      </button>
                    </form>
                  </div>
                </div>
                <div class="factor-cl border-0">
                  <div class="row">
                    <div class="col-8">
                      <h5>Enable/Disable Multi Factor Authentication</h5>
                    </div>
                    <div class="col-4 text-right">
                      <div class="toggle-tab">
                        <label class="switch" for="checkbox">
                          <input type="checkbox" id="checkbox" [checked]="qr.isMFAEnabled" [disabled]="!qr.isMFASetup"
                            (change)="toggleMFA($event)" />
                          <div class="slider round" [ngStyle]="{'cursor': qr.isMFASetup ? 'pointer' : 'default'}"></div>
                        </label>
                      </div>
                    </div>
                  </div>
                </div>
              </ng-container>
              <ng-template #loading>
                <div class="input_preview d-flex align-items-center justify-content-center">
                  <div class="spinner-border" role="status">
                    <span class="sr-only">Loading...</span>
                  </div>
                </div>
              </ng-template>
            </div>

            <!-- Change password starts -->
            <div class="tab-pane" id="tabs-3" role="tabpanel">
              <div class="max_center_400 custom-tab-change-pass">
                <form [formGroup]="passwordForm" (ngSubmit)="onPasswordSubmit()">
                  <div class="form-group">
                    <label for="oldPassword">Old Password<span class="text-danger">*</span></label>
                    <input type="password" class="form-control" id="oldPassword" formControlName="oldPassword"
                      [ngClass]="{ 'is-invalid': (submitted || form.oldPassword.touched) && form.oldPassword.errors }">
                    <div *ngIf="(submitted || form.oldPassword.touched) && form.oldPassword.errors"
                      class="invalid-feedback">
                      <div *ngIf="form.oldPassword.errors.required">Old password is required!</div>
                      <div *ngIf="form.oldPassword.errors.pattern">Password should contain atleast 1 number,
                        1 lowercase, 1 uppercase, 1 special character and must of 8 digits.</div>
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="newPassword">New Password<span class="text-danger">*</span></label>
                    <input type="password" class="form-control" id="newPassword" formControlName="newPassword"
                      [ngClass]="{ 'is-invalid': (submitted || form.newPassword.touched) && form.newPassword.errors }">
                    <div *ngIf="(submitted || form.newPassword.touched) && form.newPassword.errors"
                      class="invalid-feedback">
                      <div *ngIf="form.newPassword.errors.required">New password is required!</div>
                      <div *ngIf="form.newPassword.errors.pattern">Password should contain atleast 1 number,
                        1 lowercase, 1 uppercase, 1 special character and must of 8 digits.</div>
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="confirmPassword">Confirm Password<span class="text-danger">*</span></label>
                    <input type="password" class="form-control" id="confirmPassword" formControlName="confirmPassword"
                      [ngClass]="{ 'is-invalid': (submitted || form.confirmPassword.touched) && form.confirmPassword.errors }">
                    <div *ngIf="(submitted || form.confirmPassword.touched) && form.confirmPassword.errors"
                      class="invalid-feedback">
                      <div *ngIf="form.confirmPassword.errors.required">Confirm password is required!</div>
                      <div *ngIf="form.confirmPassword.errors.pattern">Password should contain atleast 1 number,
                        1 lowercase, 1 uppercase, 1 special character and must of 8 digits.</div>
                    </div>
                  </div>
                  <button class="btn btn-light btn_default max-270 mt-5" [disabled]="submitFlag">
                    <div class="spinner-border text-light align-top" role="status" *ngIf="submitFlag">
                      <span class="sr-only">Loading...</span>
                    </div>
                    <ng-container *ngIf="!submitFlag">Change Password</ng-container>
                  </button>
                </form>
              </div>
            </div>
            <!-- Change password ends -->
          </div>
        </div>
      </div>
    </div>
  </div>
</div>